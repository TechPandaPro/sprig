/*
First time? Check out the tutorial game:
https://sprig.hackclub.com/gallery/getting_started

@title: Spring
@author: 
@tags: []
@addedOn: 2024-00-00
*/

const player = "p"

const arrow_0 = "0"
const arrow_45 = "1"
const arrow_90 = "3"
const arrow_135 = "4"
const arrow_180 = "5"
const arrow_225 = "6"
const arrow_270 = "7"
const arrow_315 = "8"

const arrowIncrement = 45

setLegend(
  [ player, bitmap`
................
................
.......000......
.......0.0......
......0..0......
......0...0.0...
....0003.30.0...
....0.0...000...
....0.05550.....
......0...0.....
.....0....0.....
.....0...0......
......000.......
......0.0.......
.....00.00......
................` ],
//   [ arrow, bitmap`
// .......FF.......
// ......FFFF......
// .....FFFFFF.....
// .....FFFFFF.....
// ....FF.FF.FF....
// ....FF.FF.FF....
// ...FF..FF..FF...
// ...FF..FF..FF...
// .......FF.......
// .......FF.......
// .......FF.......
// .......FF.......
// .......FF.......
// .......FF.......
// .......FF.......
// .......FF.......` ],
  [ arrow_0, bitmap`
.......00.......
......0000......
.....000000.....
.....000000.....
....00.00.00....
...00..00..00...
...00..00..00...
.......00.......
.......00.......
.......00.......
.......00.......
.......00.......
.......00.......
.......00.......
.......00.......
.......00.......` ],
  [ arrow_45, bitmap`
................
................
.......0000000..
.......0000000..
..........0000..
.........00000..
........000.00..
.......000..00..
......000...00..
.....000........
....000.........
...000..........
..000...........
..00............
................
................` ],
  [ arrow_90, bitmap`
................
................
................
.........00.....
.........000....
...........000..
............000.
0000000000000000
0000000000000000
............000.
...........000..
.........000....
.........00.....
................
................
................` ],
  [ arrow_135, bitmap`
................
................
..00............
..000...........
...000..........
....000.........
.....000........
......000...00..
.......000..00..
........000.00..
.........00000..
..........0000..
.......0000000..
.......0000000..
................
................` ],
  [ arrow_180, bitmap`
.......00.......
.......00.......
.......00.......
.......00.......
.......00.......
.......00.......
.......00.......
.......00.......
.......00.......
...00..00..00...
...00..00..00...
....00.00.00....
.....000000.....
.....000000.....
......0000......
.......00.......` ],
  [ arrow_225, bitmap`
................
................
............00..
...........000..
..........000...
.........000....
........000.....
..00...000......
..00..000.......
..00.000........
..00000.........
..0000..........
..0000000.......
..0000000.......
................
................` ],
  [ arrow_270, bitmap`
................
................
................
.....00.........
....000.........
..000...........
.000............
0000000000000000
0000000000000000
.000............
..000...........
....000.........
.....00.........
................
................
................` ],
  [ arrow_315, bitmap`
................
................
..0000000.......
..0000000.......
..0000..........
..00000.........
..00.000........
..00..000.......
..00...000......
........000.....
.........000....
..........000...
...........000..
............00..
................
................` ]
)

// setSolids([ arrow_0, arrow_45 ])

let level = 0
const levels = [
  map`
......
......
......
......
......
......`
]

setMap(levels[level])

setPushables({
  [ player ]: []
})

// let arrowSprite = null
let arrowType = null

onInput("s", () => {
  // getFirst(player).y += 1
  // const arrowSprite = addSprite(2, 2, arrow_0)
  // const arrowSprite45 = addSprite(3, 2, arrow_45)
  // arrowSprite.rotate = 20
})

onInput("i", () => {
  // console.log(arrowSprite)
  // if (!arrowSprite) {
  if (arrowType === null) {
    addSprite(2, 2, arrow_0)
    arrowType = arrow_0
    // arrowSprite = getFirst(arrow_0)
    // console.log(arrowSprite)
  }
})

onInput("j", () => {
  // if (arrowSprite) {
  if (arrowType !== null) {
    // const currentType = Number(arrowSprite.type);
    const arrowTypeNum = Number(arrowType)
    
    const arrowCount = 360 / arrowIncrement
    const newType = (arrowTypeNum === arrowCount) ? 0 : (arrowTypeNum + 1);
    console.log({arrowTypeNum, arrowCount, newType})
    
    const arrowSprite = getFirst(arrowType)
    arrowSprite.type = newType.toString()
    arrowType = arrowSprite.type
    console.log(`new type: ${newType.toString()}`)
    
    // console.log(arrowSprite.type)
  }
})

console.log("hello world")

onInput("k", () => {
  console.log("pressed k")
  // console.log(arrowSprite)
  // if (arrowSprite) {
  if (arrowType !== null) {
    const arrowSprite = getFirst(arrowType)
    arrowSprite.remove()
    arrowType = null
  }
})

afterInput(() => {
  
})